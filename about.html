<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>About PARC</title>

  <!-- ===== Fonts & CSS ===== -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700|Material+Icons" rel="stylesheet">
  <link href="css/slides.css" rel="stylesheet" />

  <!-- ===== GitHub Markdown Styling ===== -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.5.1/github-markdown-dark.min.css"
    integrity="sha512-QMfGs1gnMMDnMEEwHb3mckVxJZJ1hdJ9Sv6/k2K9sH3ZLp3hDkMBiOjzWn+ATNlI/t0hGPVbK1G3YDsXTVxw3w=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

  <!-- ===== Syntax Highlighting ===== -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
  />

  <style>
    html {
      scroll-behavior: smooth;
    }

    /* ===== TOC PANEL ===== */
    .toc {
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem 1.5rem;
      border-radius: 10px;
      font-size: 1vw;
      line-height: 1.6;
      max-height: 60vh;
      overflow-y: auto;
    }

    .toc h3 {
      color: #f0c040;
      font-weight: 500;
      font-size: 1.3vw;
      margin-bottom: 0.8rem;
    }

    .toc ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }

    .toc li {
      margin-bottom: 0.4rem;
    }

    .toc a {
      color: #ddd;
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .toc a:hover,
    .toc a.active {
      color: #f0c040;
    }

    .markdown-section {
      scroll-margin-top: 140px;
    }
  </style>
</head>

<body class="slides horizontal simplifiedMobile animated resources-page">

  <!-- ===== HEADER ===== -->
  <header class="banner">
    <div class="banner-inner">
      <a href="https://parccommons.org" class="logo-link">
        <svg class="banner-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 120" preserveAspectRatio="xMidYMid meet">
          <rect x="0" y="20" width="200" height="70" fill="#896900" rx="4" />
          <text x="20" y="75" fill="#fff" font-family="Baskerville, 'Baskerville Old Face', serif" font-weight="700" font-size="48">
            P A R C
          </text>
        </svg>
      </a>
      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="people.html">People</a>
        <a href="resources.html">Research</a>
        <a href="project_pending.html">Collaborate</a>
      </nav>
    </div>
  </header>

  <!-- ===== HERO SECTION ===== -->
  <section class="slide fade-6 kenBurns">
    <div class="background" style="background-image:url('assets/img/background/PARC_wide.jpg')"></div>
    <div class="content">

      <!-- ===== TOP SPLIT SECTION ===== -->
      <div class="container two-column">
        <!-- LEFT HALF -->
        <div class="half left">
          <h1 class="ae-2 huge fromAbove margin-bottom-2" style="font-size: 3vw;">
            About PARC
          </h1>
          <p class="margin-bottom-2 ae-1 tagline">
            <span class="opacity-10" style="font-family:Georgia, 'Times New Roman', Times, serif; font-size: 1.5vw;">
              Alabama-based 501(c)(3) non-profit <br>
              We administer a <i>cyber-physical</i> research commons devoted to
              helping people build and advance rural communities.
            </span>
          </p>
        </div>

        <!-- RIGHT HALF: AUTO-GENERATED TOC -->
        <div class="half right toc" id="toc">
          <h3>Table of Contents</h3>
          <ul id="toc-list"><!-- dynamically generated --></ul>
        </div>
      </div>

      <!-- ===== MARKDOWN CONTENT ===== -->
      <div id="markdown-container" class="markdown-body"></div>
    </div>
  </section>

  <!-- ===== DEPENDENCIES ===== -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <script>
    marked.setOptions({
      highlight: function (code, lang) {
        return hljs.highlightAuto(code, [lang]).value;
      }
    });

    const docs = [
      {
        title: "Main Activities",
        url: "https://raw.githubusercontent.com/Precision-Agronomy-Research-Center/Governance/main/Main_Activites.md"
      },
      {
        title: "Governance Overview",
        url: "https://raw.githubusercontent.com/Precision-Agronomy-Research-Center/Governance/main/README.md"
      }
    ];

    async function renderMarkdownFiles() {
      const container = document.getElementById("markdown-container");
      const tocList = document.getElementById("toc-list");
      container.innerHTML = "";
      tocList.innerHTML = "";

      for (const doc of docs) {
        const section = document.createElement("section");
        section.className = "markdown-section";
        section.id = doc.title.toLowerCase().replace(/\s+/g, "-");

        try {
          const res = await fetch(doc.url);
          if (!res.ok) throw new Error(res.statusText);
          const text = await res.text();
          const html = marked.parse(text);

          // Add document content
          section.innerHTML = `
            <h2>${doc.title}</h2>
            <hr style="border: 1px solid #444; margin: 1em 0;">
            ${html}
          `;
          container.appendChild(section);

          // Add ToC link
          const li = document.createElement("li");
          const link = document.createElement("a");
          link.href = "#" + section.id;
          link.textContent = doc.title;
          li.appendChild(link);
          tocList.appendChild(li);
        } catch (err) {
          section.innerHTML = `<p style="color:red;">⚠️ Failed to load ${doc.title}: ${err.message}</p>`;
          container.appendChild(section);
        }
      }

      // Highlight active ToC link on scroll
      const links = tocList.querySelectorAll("a");
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            links.forEach(l => l.classList.remove("active"));
            const active = tocList.querySelector(`a[href="#${entry.target.id}"]`);
            if (active) active.classList.add("active");
          }
        });
      }, { rootMargin: "-40% 0px -50% 0px", threshold: 0.1 });

      document.querySelectorAll(".markdown-section").forEach(section => observer.observe(section));
    }

    renderMarkdownFiles();
  </script>
</body>
</html>
