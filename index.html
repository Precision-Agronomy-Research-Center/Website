<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, viewport-fit=cover">
	<meta name="apple-mobile-web-app-capable" content="yes" />


  <!-- Page Title -->
	<title>PARC - Precision Agronomy Research Center</title>

	<!-- Compressed Styles -->
	<link href="css/slides.css" rel="stylesheet" type="text/css">

	<!-- Custom Styles -->
	<!-- <link href="css/custom.css" rel="stylesheet" type="text/css"> -->

	<!-- jQuery 3.3.1 -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<!-- Compressed Scripts -->
	<script src="js/slides.min.js" type="text/javascript"></script>

	<!-- Custom Scripts -->
	<!-- <script src="js/custom.js" type="text/javascript"></script> -->

	<!-- Fonts and Material Icons -->

<script>
document.addEventListener('DOMContentLoaded', function() {
  let refs = document.querySelectorAll('sup[data-footnote]');
  refs.forEach(function(ref, i) {
    let number = i + 1;
    let key = ref.getAttribute('data-footnote');
    // Create the link inside the sup
    let a = document.createElement('a');
    a.href = '#footnote-' + key;
    a.textContent = '[' + number + ']';
    a.style.textDecoration = 'none';
    ref.appendChild(a);

    // Show the textbox when the link is clicked
    a.addEventListener('click', function(e) {
      e.preventDefault();
      document.querySelectorAll('.footnote-box').forEach(function(box) {
        box.style.display = 'none';
      });
      let box = document.getElementById('footnote-' + key);
      if (box) box.style.display = 'block';
      box.scrollIntoView({behavior: "smooth"});
    });
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  fetch('/key-definitions/definitions.json')
    .then(response => response.json())
    .then(data => {
      const grid = document.getElementById('definitions-grid');
      grid.innerHTML = ''; // clear loading state

      data.forEach((item, i) => {
        const li = document.createElement('li');
        li.className = `col-3-12 col-tablet-1-2 col-phablet-1-1 ae-${i+4} fromLeft done`;
        li.innerHTML = `
          <h3><u>${item.term}</u></h3>
          <p class="tiny opacity-6">${item.definition}</p>
        `;
        grid.appendChild(li);
      });
    })
    .catch(err => {
      document.getElementById('definitions-grid').innerHTML =
        '<li><p style="color:red;">Failed to load definitions.</p></li>';
      console.error(err);
    });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {

  // ---- Load Key Definitions Grid (existing code, no change needed) ----
  fetch('/key-definitions/definitions.json')
    .then(r => r.json())
    .then(definitions => {
      const grid = document.getElementById('definitions-grid');
      grid.innerHTML = '';

      definitions.forEach((item, i) => {
        const li = document.createElement('li');
        li.className = `col-3-12 col-tablet-1-2 col-phablet-1-1 ae-${i+4} fromLeft done`;
        li.innerHTML = `
          <h3><u>${item.term}</u></h3>
          <p class="tiny opacity-6">${item.definition}</p>
        `;
        grid.appendChild(li);
      });
    })
    .catch(err => {
      console.error("Definitions load failed", err);
      document.getElementById('definitions-grid').innerHTML =
        '<li><p style="color:red;">Failed to load definitions.</p></li>';
    });


  // --- Function to build the hierarchy from flat data (unchanged) ---
  /**
   * Converts a flat array of objects with parent_id into a hierarchical tree structure.
   * This is the robust interpretation logic.
   *
   * @param {Array<Object>} flatData - The flat array of objects, where each object
   *   has an an 'id', 'name', and 'parent_id' property. 'parent_id' is null for top-level items.
   * @returns {Array<Object>} A nested array representing the hierarchical structure.
   */
  function buildTabHierarchy(flatData) {
    const tree = [];
    const itemMap = new Map(); // To store references to all items for quick lookup

    // First pass: Populate itemMap and identify top-level items
    flatData.forEach(item => {
      const newItem = { ...item, children: [] }; // Clone and add children array
      itemMap.set(newItem.id, newItem); // Store reference
      if (newItem.parent_id === null) {
        tree.push(newItem); // Add top-level items to the root tree
      }
    });

    // Second pass: Link children to their parents
    flatData.forEach(item => {
      if (item.parent_id !== null) {
        const parent = itemMap.get(item.parent_id);
        if (parent) {
          parent.children.push(itemMap.get(item.id)); // Attach child to parent's children array
        } else {
          console.warn(`Parent with id ${item.parent_id} not found for item ${item.id}.`);
        }
      }
    });

    return tree;
  }
  // --- END Function ---


  // ---- Load Vital Domains Tabs (Modified to only handle tab creation and switching) ----
  fetch('/vital-domains/vital_domains.json') // Assuming this now returns the flat JSON structure
    .then(r => r.json())
    .then(flatDomainsData => { // Renamed parameter to reflect flat input
      const hierarchicalDomains = buildTabHierarchy(flatDomainsData); // Interpret data
      
      const mainTabs = document.getElementById('main-tabs');
      const subTabsContainer = document.getElementById('sub-tabs-container');
      const tabContent = document.getElementById('tab-content'); // Keep reference if needed elsewhere

      mainTabs.innerHTML = '';
      subTabsContainer.innerHTML = '';
      tabContent.innerHTML = ''; // Clear any existing content or loading state

      // Build main tabs + sub-tabs dynamically from hierarchicalDomains
      hierarchicalDomains.forEach((domainItem, i) => { // Iterate over top-level items
        // Create main tab
        const li = document.createElement('li');
        li.textContent = domainItem.name; // Use 'name' from the object
        li.dataset.show = `sub-tabs-${domainItem.id}`; // Use item ID for unique sub-tab container ID
        if (i === 0) li.classList.add('selected'); // first main tab selected
        mainTabs.appendChild(li);

        // Create sub-tabs row for this main tab
        const subUl = document.createElement('ul');
        subUl.className = 'tabs';
        subUl.id = `sub-tabs-${domainItem.id}`; // Unique ID for sub-tab container
        subUl.style.display = (i === 0) ? 'flex' : 'none'; // Show first main tab's sub-tabs

        domainItem.children.forEach((subItem, j) => { // Iterate over children for sub-tabs
          const subLi = document.createElement('li');
          if (j === 0) subLi.classList.add('selected');
          subLi.textContent = subItem.name; // Use 'name' from the sub-item

          // --- Sub-tab click handler (NO CONTENT RENDERING HERE) ---
          subLi.addEventListener('click', function() {
            // Unselect siblings
            subUl.querySelectorAll('li').forEach(t => t.classList.remove('selected'));
            subLi.classList.add('selected');

          });

          subUl.appendChild(subLi);
        });

        subTabsContainer.appendChild(subUl);
      });

      // Main tab switching (logic remains largely the same)
      mainTabs.querySelectorAll('li').forEach(tab => {
        tab.addEventListener('click', function() {
          mainTabs.querySelectorAll('li').forEach(t => t.classList.remove('selected'));
          tab.classList.add('selected');

          subTabsContainer.querySelectorAll('ul').forEach(row => row.style.display = 'none');

          const target = document.getElementById(tab.dataset.show);
          if (target) {
            target.style.display = 'flex';
            // IMPORTANT: We still trigger a click on the first sub-tab to ensure its 'selected'
            // state is applied and any specific sub-tab-related functionality (if added later) runs.
            const firstSub = target.querySelector('li');
            if (firstSub) firstSub.click(); 
          }
        });
      });
    })
    .catch(err => {
      console.error("Vital domains load failed", err);
      document.getElementById('main-tabs').innerHTML =
        '<li><p style="color:red;">Failed to load domains.</p></li>';
    });

});

</script>

  <link rel="stylesheet" as="font" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,600,700|Material+Icons"/>
 
</head>



<body class="slides horizontal simplifiedMobile animated">
		
<!-- SVG Library -->
<svg xmlns="http://www.w3.org/2000/svg" style="display:none">
  
<symbol id="logo" viewBox="0 0 1250 1025">
  <rect x="-1000" y="200" width="1050" height="387" fill="#C89800"/>
  <text x="-900" y="500" fill="#FFFFFF" font-family="Baskerville Old Face, Baskerville, serif" font-weight="700" font-size="330">PARC</text>
</symbol>

</svg>

<!-- Panel Top #05 -->
<nav class="panel top">
  <div class="sections desktop">
    <div class="left">
    <a href="https://parccommons.org" title="Slides Framework">
    <svg style="width:300px;height:90px">
      <use xlink:href="#logo"></use>
    </svg>
  </a>
</div>
<div class="center">
  <ul class="menu">
    <li><a href="index.html">Home</a></li>
    <li><a href="about.html">About</a></li>
    <li><a href="people.html">People</a></li>
    <li><a href="commons.html">Commons</a></li>
    <li><a href="resources.html">Help</a></li> 
  </ul>
</div>
  </div>
  <div class="sections compact hidden">
    <div class="left"><a href="#" title="Slides Framework"><svg style="width:82px;height:24px"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#logo"></use></svg></a></div>
    <div class="right"><span class="button actionButton sidebarTrigger" data-sidebar-id="1"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#menu"></use></svg></span</div>
  </div>
</nav>


<!-- Slide 5 (#91) -->
<section class="slide fade-6 kenBurns">
  <div class="content">
    <div class="container">
      <div class="wrap">
      
        <div class="fix-12-12 toCenter">
          <div class="fix-7-12">
            <h1 class="ae-2 huge fromAbove margin-bottom-2">The Precision Agronomy Research Center </h1>
            <p class="margin-bottom-2 ae-1">
              <span class="opacity-10" style="background: #C89800;">
                &ensp;Curating <b>Appropriate Technology</b> Across <i>Vital Domains</i>&ensp; <br>
                &ensp;For Robust and Sustainable <b>Farmsteads</b>&ensp;
              </span>
            </p>
          </div>

          <!-- KEY DEFINITIONS-->
          <ul id="definitions-grid" class="grid fixedSpaces left margin-top-10"> </ul>
          <!-- BREAK-->
          <br><!-- <hr class="hr_plain ae-2 fromAbove"> --><br>  
          <!-- DEFINITIONS-->
          <!-- <ul id="definitions-grid" class="grid fixedSpaces left margin-top-10"></ul> -->
          <!-- VITAL DOMAINS-->
          <ul class="tabs" id="main-tabs"></ul>
          <div id="sub-tabs-container"></div>
          <div id="tab-content" class="tiny opacity-6 margin-top-2"></div>

        </div>  
      </div>
    </div>
  </div>
  <div class="background" style="background-image:url(assets/img/background/PARC_wide.jpg)"></div>
</section>

</body>
</html>


<script>
document.querySelectorAll('#main-tabs li').forEach(function(tab) {
  tab.addEventListener('click', function() {
    // Remove selected from all main tabs
    document.querySelectorAll('#main-tabs li').forEach(function(t) {
      t.classList.remove('selected');
    });
    tab.classList.add('selected');

    // Hide all dependent tab rows
    document.querySelectorAll('.tabs[id$="-sub-tabs"]').forEach(function(row) {
      row.style.display = 'none';
    });

    // Show the dependent tab row if specified
    var showId = tab.getAttribute('data-show');
    if (showId) {
      var row = document.getElementById(showId);
      if (row) row.style.display = 'flex';
    }
  });
window.addEventListener('DOMContentLoaded', function() {
  var selectedMain = document.querySelector('#main-tabs li.selected');
  document.querySelectorAll('.tabs[id$="-sub-tabs"]').forEach(function(row) {
    row.style.display = 'none';
  });
  if (selectedMain && selectedMain.dataset.show) {
    var row = document.getElementById(selectedMain.dataset.show);
    if (row) row.style.display = 'flex';
  }
});
});
</script>